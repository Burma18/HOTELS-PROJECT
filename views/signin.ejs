<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body class="signinBody">
    <div class="session">
      <div class="session__image">
        <img src="/img/hotel.signin.png" alt="" />
      </div>

      <div class="title">
        <h1 class="title__h1">Welcome</h1>
      </div>

      <div class="form__group field">
        <label for="email"></label>
        <input
          type="input"
          class="form__field"
          placeholder="Email Address"
          name="email"
          id="email"
          required
        />
        <div class="email error"></div>

        <!-- <label for="name" class="form__label"></label> -->

        <!-- //////////////////////////// -->
        <label for="password"></label>
        <input
          type="password"
          name="password"
          id="password"
          class="form__field"
          placeholder="Password "
        />
        <div class="password error"></div>

        <i class="bi bi-eye-slash" id="togglePassword"></i>
        <h3 class="change__pass"><a href="#">Forgot password?</a></h3>
        <button type="submit" class="btn">Log in</button>
        <div class="allow__circle">
          <input type="radio" class="allow__input" />
          <label for="txt" class="input__txt">
            By clicking register you confirm that you have read and accepted
            <br />
            the terms. <span>User Agreement</span> and
            <span>User Privacy Notices</span></label
          >
        </div>
        <div class="hr__bar">
          <div class="line"></div>
          <p>Or</p>
          <div class="line"></div>
        </div>
        <div class="buttons">
          <button class="button" id="quote-btn">
            <img src="/img/hotel.google.jpg" alt="" class="btn__image" />Google
          </button>
          <button class="button" id="learn-btn">
            <img
              src="/img/hotel.facebook.jpg"
              alt=""
              class="btn__image"
            />Facebook
          </button>
        </div>
      </div>
    </div>
    <script>
      const togglePassword = document.querySelector("#togglePassword");
      const password = document.querySelector("#password");

      togglePassword.addEventListener("click", function () {
        // toggle the type attribute
        const type =
          password.getAttribute("type") === "password" ? "text" : "password";
        password.setAttribute("type", type);

        // toggle the icon
        this.classList.toggle("bi-eye");
      });

      const emailInput = document.querySelector("#email");
      const passwordInput = document.querySelector("#password");

      const emailError = document.querySelector(".email.error");
      const passwordError = document.querySelector(".password.error");

      const loginButton = document.querySelector(".btn");

      loginButton.addEventListener("click", async (e) => {
        e.preventDefault();

        //reset errors:
        emailError.textContent = "";
        passwordError.textContent = "";

        //get values
        const email = emailInput.value;
        const password = passwordInput.value;

        try {
          const res = await fetch("/signin", {
            method: "POST",
            body: JSON.stringify({ email, password }),
            headers: { "Content-Type": "application/json" },
          });

          const data = await res.json();

          if (data.errors) {
            emailError.textContent = data.errors.email;
            passwordError.textContent = data.errors.password;
          }
          if (data.user) {
            location.assign("/");
          }
          console.log("data.user : ", data.user);
        } catch (error) {
          console.log(error);
        }
      });
    </script>
  </body>
</html>
